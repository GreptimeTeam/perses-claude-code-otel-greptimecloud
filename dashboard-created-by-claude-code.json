{"kind":"Dashboard","metadata":{"name":"claude-code-monitoring","project":"default","version":1},"spec":{"display":{"name":"Claude Code Usage Monitoring"},"panels":{"active_sessions":{"kind":"Panel","spec":{"display":{"name":"Active Sessions"},"plugin":{"kind":"StatChart","spec":{"calculation":"last","format":{"unit":"decimal"},"sparkline":{"color":"#4287f5"}}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"count(count by (session_id)(claude_code_session_count{organization_id=~\"$organization\", user_email=~\"$user\"}))"}}}}]}},"total_cost_today":{"kind":"Panel","spec":{"display":{"name":"Total Cost Today"},"plugin":{"kind":"StatChart","spec":{"calculation":"sum","format":{"unit":"currencyUSD","decimalPlaces":2},"sparkline":{"color":"#f54242"}}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(increase(claude_code_cost_usage{organization_id=~\"$organization\", user_email=~\"$user\", model=~\"$model\"}[24h]))"}}}}]}},"total_tokens_used":{"kind":"Panel","spec":{"display":{"name":"Total Tokens Used"},"plugin":{"kind":"StatChart","spec":{"calculation":"sum","format":{"unit":"short","shortValues":true},"sparkline":{"color":"#42f554"}}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(increase(claude_code_token_usage{organization_id=~\"$organization\", user_email=~\"$user\", model=~\"$model\"}[24h]))"}}}}]}},"active_users":{"kind":"Panel","spec":{"display":{"name":"Active Users (24h)"},"plugin":{"kind":"StatChart","spec":{"calculation":"last","format":{"unit":"decimal"},"sparkline":{"color":"#f5a442"}}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"count(count by (user_email)(claude_code_session_count{organization_id=~\"$organization\", user_email=~\"$user\"} offset 24h))"}}}}]}},"token_usage_over_time":{"kind":"Panel","spec":{"display":{"name":"Token Usage Over Time"},"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"position":"bottom"}}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(rate(claude_code_token_usage{organization_id=~\"$organization\", user_email=~\"$user\", model=~\"$model\"}[5m])) by (model)"}}}}]}},"cost_trends":{"kind":"Panel","spec":{"display":{"name":"Cost Trends by Organization"},"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"position":"bottom"},"visual":{"display":"stacked-area"}}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(rate(claude_code_cost_usage{organization_id=~\"$organization\", user_email=~\"$user\", model=~\"$model\"}[5m])) by (organization_id)"}}}}]}},"session_duration":{"kind":"Panel","spec":{"display":{"name":"Average Session Active Time"},"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"position":"bottom"}}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"avg(rate(claude_code_active_time_total{organization_id=~\"$organization\", user_email=~\"$user\"}[5m])) by (terminal_type)"}}}}]}},"active_time_heatmap":{"kind":"Panel","spec":{"display":{"name":"Active Time Distribution"},"plugin":{"kind":"HeatmapChart","spec":{}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(increase(claude_code_active_time_total{organization_id=~\"$organization\", user_email=~\"$user\"}[1h])) by (user_email)"}}}}]}},"top_users_by_cost":{"kind":"Panel","spec":{"display":{"name":"Top Users by Cost"},"plugin":{"kind":"BarChart","spec":{"mode":"horizontal"}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"topk(10, sum(increase(claude_code_cost_usage{organization_id=~\"$organization\", user_email=~\"$user\", model=~\"$model\"}[24h])) by (user_email))"}}}}]}},"user_activity_table":{"kind":"Panel","spec":{"display":{"name":"User Activity Summary"},"plugin":{"kind":"Table","spec":{}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum by (user_email, organization_id) (increase(claude_code_session_count{organization_id=~\"$organization\", user_email=~\"$user\"}[24h]))"}}}}]}},"terminal_type_distribution":{"kind":"Panel","spec":{"display":{"name":"Terminal Type Distribution"},"plugin":{"kind":"PieChart","spec":{"legend":{"position":"right"}}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(increase(claude_code_session_count{organization_id=~\"$organization\", user_email=~\"$user\"}[24h])) by (terminal_type)"}}}}]}},"model_usage_breakdown":{"kind":"Panel","spec":{"display":{"name":"Model Usage Breakdown"},"plugin":{"kind":"PieChart","spec":{"legend":{"position":"right"},"visual":{"display":"donut"}}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(increase(claude_code_token_usage{organization_id=~\"$organization\", user_email=~\"$user\", model=~\"$model\"}[24h])) by (model)"}}}}]}},"session_count_trends":{"kind":"Panel","spec":{"display":{"name":"Session Count Trends"},"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"position":"bottom"}}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(rate(claude_code_session_count{organization_id=~\"$organization\", user_email=~\"$user\", model=~\"$model\"}[5m]))"}}}}]}},"token_usage_by_service":{"kind":"Panel","spec":{"display":{"name":"Token Usage by Service"},"plugin":{"kind":"BarChart","spec":{"mode":"grouped"}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(increase(claude_code_token_usage{organization_id=~\"$organization\", user_email=~\"$user\", model=~\"$model\"}[24h])) by (service_name, service_version)"}}}}]}},"cost_per_session":{"kind":"Panel","spec":{"display":{"name":"Cost Efficiency (Cost per Session)"},"plugin":{"kind":"ScatterChart","spec":{}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(increase(claude_code_cost_usage{organization_id=~\"$organization\", user_email=~\"$user\", model=~\"$model\"}[1h])) by (user_email) / sum(increase(claude_code_session_count{organization_id=~\"$organization\", user_email=~\"$user\"}[1h])) by (user_email)"}}}}]}},"organization_comparison":{"kind":"Panel","spec":{"display":{"name":"Organization Usage Comparison"},"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"position":"bottom"}}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(rate(claude_code_token_usage{organization_id=~\"$organization\", user_email=~\"$user\", model=~\"$model\"}[5m])) by (organization_id)"}}}}]}},"session_details_table":{"kind":"Panel","spec":{"display":{"name":"Session Details"},"plugin":{"kind":"Table","spec":{"columns":["session_id","user_email","organization_id","model","terminal_type","tokens","cost"]}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum by (session_id, user_email, organization_id, model, terminal_type) (claude_code_token_usage{organization_id=~\"$organization\", user_email=~\"$user\", model=~\"$model\"})"}}}}]}},"cost_breakdown":{"kind":"Panel","spec":{"display":{"name":"Cost Breakdown Analysis"},"plugin":{"kind":"BarChart","spec":{"mode":"stacked"}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(increase(claude_code_cost_usage{organization_id=~\"$organization\", user_email=~\"$user\", model=~\"$model\"}[24h])) by (model, organization_id)"}}}}]}},"usage_patterns":{"kind":"Panel","spec":{"display":{"name":"Usage Patterns by Hour"},"plugin":{"kind":"TimeSeriesChart","spec":{"legend":{"position":"bottom"}}},"queries":[{"kind":"TimeSeriesQuery","spec":{"plugin":{"kind":"PrometheusTimeSeriesQuery","spec":{"query":"sum(increase(claude_code_session_count{organization_id=~\"$organization\", user_email=~\"$user\", model=~\"$model\"}[1h]))"}}}}]}}},"layouts":[{"kind":"Grid","spec":{"display":{"title":"Overview","collapse":{"open":true}},"items":[{"x":0,"y":0,"width":3,"height":3,"content":{"$ref":"#/spec/panels/active_sessions"}},{"x":3,"y":0,"width":3,"height":3,"content":{"$ref":"#/spec/panels/total_cost_today"}},{"x":6,"y":0,"width":3,"height":3,"content":{"$ref":"#/spec/panels/total_tokens_used"}},{"x":9,"y":0,"width":3,"height":3,"content":{"$ref":"#/spec/panels/active_users"}}]}},{"kind":"Grid","spec":{"display":{"title":"Usage Trends","collapse":{"open":true}},"items":[{"x":0,"y":0,"width":6,"height":6,"content":{"$ref":"#/spec/panels/token_usage_over_time"}},{"x":6,"y":0,"width":6,"height":6,"content":{"$ref":"#/spec/panels/cost_trends"}},{"x":0,"y":6,"width":6,"height":6,"content":{"$ref":"#/spec/panels/session_duration"}},{"x":6,"y":6,"width":6,"height":6,"content":{"$ref":"#/spec/panels/active_time_heatmap"}}]}},{"kind":"Grid","spec":{"display":{"title":"User Analytics","collapse":{"open":true}},"items":[{"x":0,"y":0,"width":6,"height":6,"content":{"$ref":"#/spec/panels/top_users_by_cost"}},{"x":6,"y":0,"width":6,"height":6,"content":{"$ref":"#/spec/panels/user_activity_table"}},{"x":0,"y":6,"width":6,"height":6,"content":{"$ref":"#/spec/panels/terminal_type_distribution"}},{"x":6,"y":6,"width":6,"height":6,"content":{"$ref":"#/spec/panels/model_usage_breakdown"}}]}},{"kind":"Grid","spec":{"display":{"title":"Performance Metrics","collapse":{"open":true}},"items":[{"x":0,"y":0,"width":6,"height":6,"content":{"$ref":"#/spec/panels/session_count_trends"}},{"x":6,"y":0,"width":6,"height":6,"content":{"$ref":"#/spec/panels/token_usage_by_service"}},{"x":0,"y":6,"width":6,"height":6,"content":{"$ref":"#/spec/panels/cost_per_session"}},{"x":6,"y":6,"width":6,"height":6,"content":{"$ref":"#/spec/panels/organization_comparison"}}]}},{"kind":"Grid","spec":{"display":{"title":"Detailed Analysis","collapse":{"open":false}},"items":[{"x":0,"y":0,"width":12,"height":6,"content":{"$ref":"#/spec/panels/session_details_table"}},{"x":0,"y":6,"width":6,"height":6,"content":{"$ref":"#/spec/panels/cost_breakdown"}},{"x":6,"y":6,"width":6,"height":6,"content":{"$ref":"#/spec/panels/usage_patterns"}}]}}],"variables":[{"kind":"Variable","metadata":{"name":"organization"},"spec":{"name":"organization","display":{"name":"Organization","description":"Filter by organization ID"},"defaultValue":".*","source":"PrometheusLabelValuesVariable"}},{"kind":"Variable","metadata":{"name":"user"},"spec":{"name":"user","display":{"name":"User","description":"Filter by user email"},"defaultValue":".*","source":"PrometheusLabelValuesVariable"}},{"kind":"Variable","metadata":{"name":"model"},"spec":{"name":"model","display":{"name":"Model","description":"Filter by model type"},"defaultValue":".*","source":"PrometheusLabelValuesVariable"}}],"duration":"5m","refreshInterval":"30s","datasources":{}}}